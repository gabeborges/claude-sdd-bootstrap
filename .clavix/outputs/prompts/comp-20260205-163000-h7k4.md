---
id: comp-20260205-163000-h7k4
depthUsed: comprehensive
timestamp: 2026-02-05T16:30:00Z
executed: false
originalPrompt: "based on CLAUDE.md, AGENTS.md, and claude/commands/orchestrate.md, analyse agents/instructions.md and fix any mismatch and improve it based on your knowledge about Claude code agents. This is an instructions file for agents orchestratation."
---

# Improved Prompt

# Rewrite agents/instructions.md for Consistency and Token Efficiency

## Objective
Rewrite `agents/instructions.md` to eliminate all inconsistencies with the current AGENTS.md, CLAUDE.md, and `claude/commands/orchestrate.md`. This file serves as a supporting reference for agent orchestration — it must not contradict the authoritative sources and should be optimized for AI consumption.

## Authoritative Sources (in order)
1. **AGENTS.md** — canonical agent roster, 6-tier DAG, SDD artifact flow, prerequisite rules, folder structure, Definition of Done
2. **CLAUDE.md** — project rules, SDD artifact flow, security guardrails, token/context rules
3. **claude/commands/orchestrate.md** — the skill that actually executes orchestration
4. **agents/instructions.md** — the file being corrected (lowest authority)

When instructions.md conflicts with any of the above, the higher-authority source wins.

## Known Inconsistencies to Fix

### Category A: Wrong File Extensions
instructions.md uses `.md` extensions where the project has standardized on `.yaml`:
- `tasks.md` → `tasks.yaml` (throughout — appears 15+ times)
- `spec-change-requests.md` → `spec-change-requests.yaml` (lines 30, 40, 97)
- `design.md` (line 77, 86) → `system-design.yaml` (per AGENTS.md: `.ops/build/system-design.yaml`)

`specs.md` stays as `.md` — this is correct per project standards.

### Category B: Wrong Tier DAG
instructions.md line 29 shows a 7-tier DAG (T1-T7) that does NOT match AGENTS.md:
```
Current (wrong): T1: context-manager → T2: spec-writer → T3: project-task-planner → T4: ui/security/compliance → T5: frontend/DBA → T6: fullstack/test-automator → T7: qa/review/audit
```
Missing: `architect` agent entirely. Missing: `knowledge-synthesizer` from T1.

Correct (per AGENTS.md):
```
Tier 1: workflow-orchestrator, context-manager, knowledge-synthesizer
Tier 2: spec-writer → architect → project-task-planner (sequential)
Tier 3: ui-designer, security-engineer, compliance-engineer (parallel)
Tier 4: frontend-designer, database-administrator (parallel)
Tier 5: fullstack-developer, test-automator (parallel)
Tier 6: qa, debugger, code-reviewer, security-auditor, compliance-auditor (parallel)
```

### Category C: Missing Agents
- `architect` — missing from the agent table entirely. Per AGENTS.md: role is "System design maintainer", planning category, produces `system-design.yaml`
- `knowledge-synthesizer` — missing from the agent table. Per AGENTS.md: role is "Deviation logger + build knowledge compactor", orchestration category

### Category D: Stale References
- `OpenSpec` references (lines 9, 50, 90) — the project no longer uses this term. Replace with `SDD` or remove
- `Clavix intent summary` (line 50) — stale reference, not part of current workflow
- `proposal.md` (line 85) — not in AGENTS.md folder structure
- `product-principles.md`, `tech-stack-constraints.md`, `system-invariants.md`, `security-baseline.md`, `compliance-baseline.md`, `db-standards.md`, `api-standards.md`, `testing-strategy.md`, `release-policy.md` (lines 69-80) — all marked "not yet implemented". Remove phantom files that don't exist
- `ui.md` (line 92) — not in AGENTS.md folder structure; ui-designer output goes to the UI design system, not a per-feature file
- `security.md` (line 94) — not in AGENTS.md folder structure
- `compliance.md` (line 95) — not in AGENTS.md folder structure
- `design.md` at version level (line 86) — should be `system-design.yaml` at build level per AGENTS.md

### Category E: Redundancy with AGENTS.md
The agent roster table (lines 44-62) duplicates content from AGENTS.md's roster but with DIFFERENT column structure and some contradictory details. Since AGENTS.md is the authoritative roster, instructions.md should reference it rather than maintain a parallel table that drifts.

### Category F: Missing SDD Rules
- No prerequisite rules (prd→specs→system-design→tasks chain)
- No `implements:` traceability requirement in Definition of Done
- Missing `implementation-status.md` from folder structure (per AGENTS.md)
- Missing `checks.yaml` from AGENTS.md folder structure (it IS in instructions.md but path format differs)

## Review Dimensions

### Dimension 1: Eliminate Contradictions
Every fact in instructions.md must match AGENTS.md, CLAUDE.md, and orchestrate.md. If it contradicts, fix it. If it duplicates, reference the authoritative source instead.

### Dimension 2: Remove Phantom Content
Remove references to files, tools, and concepts that don't exist in the current project:
- "not yet implemented" files
- OpenSpec references
- Files not in AGENTS.md folder structure

### Dimension 3: Token Efficiency
This file is read by agents on-demand. Evaluate:
- Is the agent roster table necessary, or should it reference AGENTS.md?
- Is the folder structure necessary, or should it reference AGENTS.md?
- Can verbose prose be tightened to tables/bullets?
- Is there content here that adds value beyond what AGENTS.md already provides?

### Dimension 4: Purpose Clarity
Clarify what this file IS and ISN'T:
- It IS a supplementary reference for agent orchestration (inputs/outputs, message protocol)
- It is NOT the canonical agent roster (that's AGENTS.md)
- It is NOT the orchestration command (that's orchestrate.md)
- It should add value that those two files don't already provide

## Constraints
- Only modify `agents/instructions.md`
- Do NOT modify AGENTS.md, CLAUDE.md, or orchestrate.md
- Do NOT fabricate new agents, files, or workflow steps
- All changes must be traceable to AGENTS.md, CLAUDE.md, or orchestrate.md
- Remove phantom content rather than inventing replacements
- If the file becomes redundant with AGENTS.md after fixes, note this — the user may want to consolidate

## Process
1. Read current CLAUDE.md
2. Read current AGENTS.md
3. Read current `claude/commands/orchestrate.md`
4. Read current `agents/instructions.md`
5. Apply all fixes across categories A-F
6. Evaluate whether the file still adds unique value after fixes
7. Read back instructions.md to verify

## Output Format
For each change, provide:
```
### Change N: [Short title]
**Category**: [A-F]
**Source rule**: [Which authoritative source this traces to]
**Current**: [What instructions.md says now]
**Fixed**: [What it should say]
```

After all changes, provide:
| # | Change | Category | Source |
|---|--------|----------|--------|

## Quality Criteria
- Zero references to `tasks.md` (should be `tasks.yaml`)
- Zero references to `spec-change-requests.md` (should be `.yaml`)
- Zero references to `design.md` for system design (should be `system-design.yaml`)
- Zero references to OpenSpec
- Zero "not yet implemented" phantom files
- Tier DAG matches AGENTS.md 6-tier structure exactly
- Architect and knowledge-synthesizer present
- Agent roster either matches AGENTS.md or references it
- Folder structure either matches AGENTS.md or references it
- Every change cites its authoritative source
- No fabricated content

## Quality Scores
- **Clarity**: 92%
- **Efficiency**: 88%
- **Structure**: 95%
- **Completeness**: 94%
- **Actionability**: 92%
- **Specificity**: 92%
- **Overall**: 92% (excellent)

## Original Prompt
```
based on CLAUDE.md, AGENTS.md, and claude/commands/orchestrate.md, analyse agents/instructions.md and fix any mismatch and improve it based on your knowledge about Claude code agents. This is an instructions file for agents orchestratation.
```

## Validation Checklist
- [ ] All `tasks.md` references changed to `tasks.yaml`
- [ ] All `spec-change-requests.md` references changed to `.yaml`
- [ ] All `design.md` system design references changed to `system-design.yaml`
- [ ] Tier DAG matches AGENTS.md 6-tier structure (architect in T2, knowledge-synthesizer in T1)
- [ ] Architect agent present in roster/reference
- [ ] Knowledge-synthesizer agent present in roster/reference
- [ ] Zero OpenSpec references remaining
- [ ] Zero "not yet implemented" phantom files remaining
- [ ] Folder structure matches AGENTS.md
- [ ] No contradictions with orchestrate.md tier execution
- [ ] No fabricated content — all changes traceable to authoritative sources
- [ ] File still adds unique value (or note if it's now redundant)

## Edge Cases
- The agent table (lines 44-62) has detailed Inputs/Outputs columns that AGENTS.md does NOT have — this is potentially unique value worth preserving (in corrected form)
- The "Message protocol" section (lines 38-42) overlaps with orchestrate.md gate checking — decide if it adds value here
- `checks.yaml` (line 100) IS a real file but its path may need updating to match AGENTS.md folder structure
- The "System Design" section (lines 102-105) mentions the architect and spec_change_requests flow — this is correct but may now be redundant with AGENTS.md's SDD Artifact Flow section
- `./ops/build/system-design.yaml` (line 103) uses `./ops/` prefix instead of `.ops/` — verify correct prefix per AGENTS.md
- `decisions-log.md` appears both at build level (line 81) and feature level (line 96) — AGENTS.md only shows it at build level (`.ops/build/decisions-log.md`)
