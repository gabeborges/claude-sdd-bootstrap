---
id: comp-20260205-153000-m4k8
depthUsed: comprehensive
timestamp: 2026-02-05T15:30:00Z
executed: false
originalPrompt: "take CLAUDE.md, AGENTS.md, claude/commands/orchestrate.md, claude/agents/instructions.md and claude/agents/swarm-config.md and tell me if I should add database migration planning during the SDD planning phase instead of where it is today? In addition to that, is there any improvement to the workflow that we can make so we better follow/enforce SDD? Generate a report in .ops/analysis"
---

# Improved Prompt

Analyze the SDD workflow for two specific improvement opportunities by reading CLAUDE.md, AGENTS.md, claude/commands/orchestrate.md, claude/agents/instructions.md, and claude/agents/swarm-config.md.

## Context

The SDD agent swarm follows a defined artifact chain:
  prd.md → specs.md (spec-writer) → system-design.yaml (architect) → tasks.yaml (project-task-planner)

Database migration planning (database-administrator agent producing db-migration-plan.yaml) currently happens during the IMPLEMENTATION phase, after tasks.yaml is generated. The question is whether it should move earlier — into the PLANNING phase alongside system-design.yaml.

## Analysis Track 1: Database Migration Timing

Evaluate whether database migration planning should happen during the SDD planning phase (after system-design.yaml, before or alongside tasks.yaml) instead of during implementation.

For each file listed above, examine:
- Where does database migration planning currently sit in the workflow sequence?
- What are the upstream dependencies (what does db-migration-plan.yaml need as input)?
- What are the downstream consumers (what reads db-migration-plan.yaml)?
- Does late migration planning create risks? (e.g., tasks generated without schema awareness, implementation blocked waiting for migration plan, spec-change-requests triggered by schema conflicts discovered too late)
- Does early migration planning create risks? (e.g., premature schema design before specs are stable, wasted effort if specs change)

Deliver a clear recommendation: MOVE to planning phase, KEEP in implementation phase, or HYBRID (schema design in planning, migration scripts in implementation). Justify with evidence from the files.

## Analysis Track 2: SDD Workflow Enforcement Gaps

Identify concrete gaps in how the current workflow files enforce SDD discipline. Focus on:

1. **Gate enforcement** — Are there mandatory checkpoints between phases? Can agents skip ahead (e.g., generate tasks.yaml without system-design.yaml)? What happens if they do?
2. **Artifact dependency validation** — Do workflow files verify prerequisites exist before allowing the next phase? Are these checks explicit or assumed?
3. **Feedback loops** — When implementation reveals spec problems, is the escalation path (spec-change-requests.yaml) clearly enforced? Can agents work around it?
4. **Agent boundary violations** — Can agents read/write files outside their declared contracts? Is this enforced or just documented?
5. **Orchestration gaps** — Does orchestrate.md cover all transitions? Are there workflow states that aren't handled?

For each gap found, propose a specific fix (new rule, new gate check, new workflow step).

## Expected Output

Generate a report (markdown) at `.ops/analysis/sdd-workflow-improvements.md` with:

1. **DB Migration Timing Analysis** — Current state, risk assessment, recommendation with rationale
2. **SDD Enforcement Gap Analysis** — Each gap with evidence (file + line), impact, and proposed fix
3. **Priority Ranking** — All recommendations ordered by impact
4. **Implementation Checklist** — Specific file edits needed (but NOT executed)

Do NOT make changes to any files. Output is the report only.

## Quality Scores
- **Clarity**: 90%
- **Efficiency**: 85%
- **Structure**: 92%
- **Completeness**: 90%
- **Actionability**: 90%
- **Specificity**: 88%
- **Overall**: 89% (good)

## Original Prompt
```
take CLAUDE.md, AGENTS.md, claude/commands/orchestrate.md, claude/agents/instructions.md and claude/agents/swarm-config.md and tell me if I should add database migration planning during the SDD planning phase instead of where it is today? In addition to that, is there any improvement to the workflow that we can make so we better follow/enforce SDD? Generate a report in .ops/analysis
```

## Alternative Approaches

**1. Narrow Focus: DB Migration Only**
Drop the general SDD improvement track entirely. Focus deeply on the migration timing question with a full tradeoff analysis including sequence diagrams.
Best for: Quick, focused decision-making on a single question.

**2. Broad SDD Audit**
Expand to a full SDD workflow audit covering all 20 agents, not just the 5 files listed. Include the governance report findings from the previous analysis.
Best for: Comprehensive overhaul of the entire workflow system.

**3. Simulation-Based Analysis**
Walk through a concrete feature (e.g., the booking system from the sample PRD) end-to-end through the SDD pipeline, noting where DB migration timing and enforcement gaps cause real problems.
Best for: Evidence-based findings grounded in a real scenario rather than abstract analysis.

## Validation Checklist

- [ ] All 5 specified files were read and referenced with line numbers
- [ ] DB migration recommendation is one of: MOVE / KEEP / HYBRID with clear rationale
- [ ] Each enforcement gap cites a specific file and line as evidence
- [ ] Proposed fixes are specific (not "improve documentation")
- [ ] No changes were made to any files — report only

## Edge Cases

- What if specs change after migration planning? (Does moving it early create rework?)
- What if the database-administrator agent needs input from the architect that doesn't exist yet in the planning phase?
- What if some features don't need DB migrations at all — does adding a planning-phase gate slow them down?
- What about the interaction between db-migration-plan.yaml and spec-change-requests.yaml — can a late schema conflict trigger a spec change?
