---
id: comp-20260205-130000-w8f1
depthUsed: comprehensive
timestamp: 2026-02-05T13:00:00Z
executed: false
originalPrompt: "I need to make a few changes to CLAUDE.MD and AGENT.md:\n\n1. Add architect agent to the workflow as a planning agent (see full list of agents in /agents)\n2. system-design.md and tasks.md should be an .yaml file so it's more performatic for AI (keep spec.md as md)\n3. If there are no system-design.yaml file, it should be created by the architect before tasks being created (fix the workflow)\n4. The flow is specs -> system design -> tasks"
---

# Improved Prompt

# Update CLAUDE.md and AGENTS.md: Workflow & Format Changes

## Objective
Apply 4 interrelated changes to CLAUDE.md and AGENTS.md that refine the SDD workflow, add the architect agent, and switch artifact formats for AI efficiency.

## Context
- CLAUDE.md and AGENTS.md were just consolidated (previous task)
- The architect agent already exists at `agents/architect.md` — read it first
- Current SDD artifacts reference `.md` format for system-design and tasks
- Current workflow may not enforce system-design as a prerequisite for tasks

## Changes Required

### Change 1: Add Architect Agent to Workflow
- Read `agents/architect.md` to understand its current role definition
- Add architect to the agent roster table in AGENTS.md
- Place architect in the correct tier of the dependency DAG (planning tier, after spec-writer, before project-task-planner)
- Add architect to the agent selection guide with trigger: "system design needed" or "architecture decisions required"
- The architect is a **planning agent** — it produces system-design.yaml, not code

### Change 2: Change File Formats to YAML
Update all references in BOTH files:
| Old Reference | New Reference | Why |
|---|---|---|
| `system-design.md` | `system-design.yaml` | Structured data, faster AI parsing |
| `tasks.md` | `tasks.yaml` | Structured data, faster AI parsing |
| `specs.md` | `specs.md` (NO CHANGE) | Prose-heavy, markdown is appropriate |

This affects:
- CLAUDE.md: SDD artifact references, "read before coding" list
- AGENTS.md: SDD artifacts table, file role definitions, folder structure

### Change 3: Enforce system-design.yaml Prerequisite
Add a workflow rule: tasks.yaml CANNOT be created until system-design.yaml exists for that feature/version. Specifically:
- In AGENTS.md workflow section: add prerequisite check
- If system-design.yaml is missing → architect must create it first
- This is a **stop condition** — do not proceed to task creation without it

### Change 4: Codify the SDD Flow Order
The canonical artifact creation order is:
```
specs.md → system-design.yaml → tasks.yaml
```
- specs.md: written by spec-writer (requirements + acceptance criteria)
- system-design.yaml: written by architect (technical architecture decisions)
- tasks.yaml: written by project-task-planner (implementation tickets)

Update AGENTS.md to reflect this flow explicitly in the workflow section.
Update CLAUDE.md "read before coding" list to match this order.

## Constraints
- Do NOT fabricate content — only modify references and add architect from existing `agents/architect.md`
- Do NOT change any other agent definitions
- Do NOT rename actual files on disk (this is about references in docs)
- Preserve all security rules in CLAUDE.md
- Keep both files concise (CLAUDE.md < 150 lines target)

## Process
1. Read `agents/architect.md` to understand the agent's role
2. Read current CLAUDE.md
3. Read current AGENTS.md
4. Apply all 4 changes to both files
5. Verify: architect in roster, .yaml references updated, flow order correct, prerequisite rule added
6. Read back both files to confirm

## Quality Criteria
- Architect appears in agent roster, DAG, and selection guide
- Zero remaining references to `system-design.md` or `tasks.md` (should be .yaml)
- `specs.md` references unchanged (still .md)
- Flow order `specs.md → system-design.yaml → tasks.yaml` explicitly documented
- Prerequisite rule: "no tasks.yaml without system-design.yaml" is a stop condition
- CLAUDE.md still < 150 lines
- No security rules lost

## Quality Scores
- **Clarity**: 92%
- **Efficiency**: 90%
- **Structure**: 95%
- **Completeness**: 90%
- **Actionability**: 92%
- **Specificity**: 88%
- **Overall**: 91% (excellent)

## Original Prompt
```
I need to make a few changes to CLAUDE.MD and AGENT.md:

1. Add architect agent to the workflow as a planning agent (see full list of agents in /agents)
2. system-design.md and tasks.md should be an .yaml file so it's more performatic for AI (keep spec.md as md)
3. If there are no system-design.yaml file, it should be created by the architect before tasks being created (fix the workflow)
4. The flow is specs -> system design -> tasks
```

## Validation Checklist
- [ ] `agents/architect.md` was read before making changes
- [ ] Architect appears in AGENTS.md agent roster table
- [ ] Architect placed in correct DAG tier (planning, after spec-writer)
- [ ] Architect in selection guide with clear trigger
- [ ] All `system-design.md` references changed to `system-design.yaml`
- [ ] All `tasks.md` references changed to `tasks.yaml`
- [ ] All `specs.md` references remain as `.md`
- [ ] Flow order `specs.md -> system-design.yaml -> tasks.yaml` documented
- [ ] Stop condition for missing system-design.yaml added
- [ ] CLAUDE.md < 150 lines
- [ ] No security rules lost

## Edge Cases
- CLAUDE.md "read before coding" list currently references `system-design.yaml` at root — check current file for correct path
- The architect may already be partially referenced in AGENTS.md from the consolidation — check for duplicates before adding
- `tasks.md` inside `.ops/build/v{x}/<feature>/` is feature-level — make sure the YAML change applies to these paths too, not just top-level references
