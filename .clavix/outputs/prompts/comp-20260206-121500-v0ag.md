---
id: comp-20260206-121500-v0ag
depthUsed: comprehensive
timestamp: 2026-02-06T12:15:00Z
executed: false
previousPromptId: std-20260206-120000-v0bs
originalPrompt: "on .clavix/outputs/prompts/std-20260206-120000-v0bs.md it's important to understand that v0 might happen in different product meaning that all tooling and tech denifitions might be completely different. For example, a project can be a iOS app, or an Stripe app marketplace app, or a web app. These require different tools and stacks. So the plan should consider that these definitions will come downstream. Update the prompt plan considering this understanding"
---

# Improved Prompt

## Objective

Create a stack-agnostic v0 bootstrap system that detects first-run projects,
reads the project's declared stack/platform, and performs one-time initial setup:
tooling configuration, local environment scaffolding, seed generation, and a
step-by-step dependency checklist tailored to the actual project type.

## Context

- This is a FRAMEWORK-LEVEL system — not specific to any single stack
- SDD workflow with agent swarm (agents in `claude/agents/`)
- Build versions live in `.ops/build/v{x}/`
- This system runs ONCE per project — when no prior version exists
- The project's stack, platform, and dependencies are defined upstream in:
  - `CLAUDE.md` (## Stack section)
  - `.ops/product-vision-strategy.md` or its distilled files
  - `.clavix/config.json` (if present)

## Key Design Principle: Stack Comes From Upstream

The bootstrap system does NOT define what stack to use. Instead it:
1. **Reads** the declared stack from project config (CLAUDE.md, PRD, config.json)
2. **Maps** that stack to a bootstrap profile (tooling, env vars, seeds, checklist)
3. **Executes** the profile-specific setup

### Example Product Types & Their Profiles

| Product Type | Stack Example | Package Mgr | Env File | Seed Type | Key Services |
|-------------|---------------|-------------|----------|-----------|-------------|
| Web app (Next.js) | Next.js, Tailwind, Supabase | npm | .env.local | SQL seeds | Supabase, Stripe, OAuth |
| iOS app | Swift, SwiftUI, Firebase | SPM/CocoaPods | .xcconfig | Firestore seeds | Firebase, App Store Connect |
| Stripe marketplace | Next.js, Stripe Connect | npm | .env.local | Stripe fixtures | Stripe Connect, webhooks |
| API service | Express/Fastify, PostgreSQL | npm | .env | SQL migrations | Database, external APIs |
| Mobile (React Native) | RN, Expo, Supabase | npm | .env | SQL seeds | Supabase, push notifications |
| Desktop (Electron) | Electron, React | npm | .env | Local DB seeds | OS-specific APIs |

These are EXAMPLES — the system should handle any stack by reading the declared config.

## Requirements

### 1. V0 Detection (Stack-Agnostic)
- Agent checks for the absence of `.ops/build/v0/` or sentinel `.ops/.v0-initialized`
- If v0 already initialized, skip with message: "Project already bootstrapped"
- Detection works from any Clavix command or agent entry point
- Detection logic is the SAME regardless of stack

### 2. Stack Discovery
- Read `CLAUDE.md` → extract `## Stack` section
- Parse declared technologies, frameworks, services, and package manager
- If no stack declared: STOP and prompt user to define stack in CLAUDE.md first
- Output: a structured stack profile used by all subsequent steps

### 3. Tooling Configuration (Stack-Driven)
Based on discovered stack profile:
- Verify runtime prerequisites (Node.js, Xcode, Python, etc.)
- Initialize missing config files appropriate to the stack:
  - **Web/Node**: `.eslintrc`, `.prettierrc`, `tsconfig.json`
  - **iOS/Swift**: `.swiftlint.yml`, project scheme settings
  - **Python**: `pyproject.toml`, `.flake8`, `mypy.ini`
  - (Agent derives this from stack — not hardcoded per platform)
- Verify `.gitignore` covers stack-appropriate patterns:
  - Always: `.env`, `.env.*`, credentials, secrets
  - Stack-specific: `node_modules/`, `.next/`, `Pods/`, `__pycache__/`, etc.

### 4. Local Environment Scaffolding (Stack-Driven)
- Create env template file (name varies by stack):
  - `.env.local.example` (Next.js/web)
  - `.env.example` (generic Node)
  - `.xcconfig.example` (iOS)
  - Stack-appropriate format
- Populate with env vars required by the declared services:
  - For each service in stack (Supabase, Stripe, Firebase, etc.),
    add the known required env vars with descriptive comments
  - Include generation hints where applicable (e.g., "run: openssl rand -base64 32")
- If local env file doesn't exist, copy from template

### 5. Seed Generation (Stack-Driven)
Based on the declared data layer:
- **SQL database** (Supabase/PostgreSQL): `supabase/seed.sql` + runner script
- **Firebase/Firestore**: `firebase/seed.json` + `scripts/seed-firestore.ts`
- **No database**: Skip seed generation, note in checklist
- **Stripe fixtures**: `stripe/fixtures.json` for test data
- Seeds contain ONLY non-sensitive test data
- Add appropriate `npm run db:seed` (or equivalent) script

### 6. User Dependency Checklist (Stack-Driven)
Generate `.ops/build/v0/setup-checklist.md` tailored to the actual stack:
- Only include steps for services declared in the stack
- Each step includes: what to do, where to go (URL), what value to set where
- Common pattern per service:
  1. Create account/project for [service]
  2. Get credentials/keys
  3. Set in env file at [specific var name]
  4. Verify with [test command]
- End with: install dependencies → seed data → run dev server → verify

### 7. Post-Bootstrap
- Create sentinel `.ops/.v0-initialized` with timestamp + stack profile used
- Create `.ops/build/v0/` directory structure
- Log summary: what was created, what was skipped, what needs user action

## Constraints
- NEVER generate actual secrets or API keys — only placeholders
- NEVER commit env files with values — only templates/examples
- NEVER hardcode stack assumptions — always derive from project config
- All seed data must be non-sensitive test data
- Idempotent: running twice should not duplicate or break anything
- Follow existing project conventions (read from CLAUDE.md)
- If stack is unknown or ambiguous: ASK, don't guess

## Success Criteria
- A fresh clone + bootstrap + completed checklist = working local environment
- Works for ANY declared stack (web, iOS, API, marketplace, etc.)
- Agents detect v0 state and trigger this automatically (once)
- No secrets exposed in any committed file
- Checklist is specific to the actual project — not generic boilerplate

## Quality Scores
- **Clarity**: 94%
- **Efficiency**: 82%
- **Structure**: 95%
- **Completeness**: 92%
- **Actionability**: 90%
- **Specificity**: 85%
- **Overall**: 91% (excellent)

## Original Prompt
```
on .clavix/outputs/prompts/std-20260206-120000-v0bs.md it's important to understand that v0 might happen in different product meaning that all tooling and tech denifitions might be completely different. For example, a project can be a iOS app, or an Stripe app marketplace app, or a web app. These require different tools and stacks. So the plan should consider that these definitions will come downstream. Update the prompt plan considering this understanding
```

## Alternative Approaches

### 1. Stack Profile Registry
Pre-define bootstrap profiles as YAML files (e.g., `profiles/nextjs-supabase.yaml`, `profiles/ios-firebase.yaml`). Bootstrap reads `CLAUDE.md`, matches to a profile, executes it.
**Best for:** Teams with many projects on known stacks.

### 2. Interactive Wizard
Instead of reading from `CLAUDE.md`, bootstrap runs an interactive Q&A: "What platform? What database? What auth?" and builds the config on-the-fly.
**Best for:** Greenfield projects where `CLAUDE.md` doesn't exist yet.

### 3. Plugin Architecture
Each service (Supabase, Stripe, Firebase, etc.) is a self-contained plugin with its own env vars, seeds, and checklist steps. Bootstrap composes the right plugins based on the stack.
**Best for:** Maximum extensibility and community contributions.

## Validation Checklist
- [ ] Bootstrap works with a Next.js + Supabase + Stripe project (current repo)
- [ ] Bootstrap works with a hypothetical iOS + Firebase project
- [ ] Bootstrap correctly STOPs when no stack is declared
- [ ] Sentinel file records which stack profile was used
- [ ] Re-running bootstrap on an initialized project skips cleanly
- [ ] Generated checklist only contains steps for declared services
- [ ] No hardcoded service names in the core bootstrap logic

## Edge Cases
- Project has no `## Stack` section in `CLAUDE.md` → must stop and ask
- Project uses a stack not in any known profile → fall back to generic + warn
- Project uses multiple platforms (web + mobile) → handle as composite stack
- Mid-bootstrap failure (e.g., can't create directory) → partial state recovery
- Stack changes after v0 is initialized → sentinel should not block re-bootstrap; consider a `--force` flag or migration path
