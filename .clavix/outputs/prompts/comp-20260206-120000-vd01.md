---
id: comp-20260206-120000-vd01
depthUsed: comprehensive
timestamp: 2026-02-06T12:00:00Z
executed: true
originalPrompt: "create a /vision:distill command that will take product-vision-strategy.md file and and break it down into smaller, AI efficient files. My proposal (but feel free to analyze and let me decide if you want to change something): quick-product-vision-strategy.md: §1, §2, §3, §4, §5, §6, §7, §12; security-compliance-baseline.md: §10, §11, §12, §15, §16; tech-architecture-baseline.md: §8, §9, §10, §12, §13, §14, §15, §16. These files needs to live inside .ops/ (high level) and will be consumed by agents during SDD. It's important that this command scans the original file and judge if a section can be used or not for the file generation every. Why? this command will be used to create many different products, sometimes there will be more clarity around a section than others."
---

# Improved Prompt

Create a `/vision:distill` slash command at `.claude/commands/vision/distill.md`.

## Purpose

Split `.ops/product-vision-strategy.md` into 3 smaller, AI-efficient files that agents consume during SDD. Each file serves a different agent domain so agents load only what they need (~30-40% of the full doc) instead of the entire vision document.

## Source

Read: `.ops/product-vision-strategy.md`
Error if missing: "No vision document found at `.ops/product-vision-strategy.md`. Run `/clavix:product` first."

## Section-to-File Mapping

| Output File | Sections | Purpose |
|---|---|---|
| `.ops/quick-product-vision-strategy.md` | §1 Vision, §2 Problem Space, §3 Target Customers, §4 Value Proposition, §5 Strategic Pillars, §6 Success Metrics, §7 Non-Goals, §12 AI Strategy | Product context for agents that need "what are we building and why" |
| `.ops/security-compliance-baseline.md` | §10 Data Principles (Compliance & Auditability Guarantees subsection + Data Flow Rules), §11 Security & Compliance Posture, §12 AI Strategy, §15 Technical Non-Goals, §16 Change Policy | Security/compliance constraints for agents that enforce safety rules |
| `.ops/tech-architecture-baseline.md` | §8 Core Platform & Tooling, §9 Architectural Approach, §10 Data Principles (full), §12 AI Strategy, §13 Integration Philosophy, §14 Scalability Intent, §15 Technical Non-Goals, §16 Change Policy | Architecture context for agents that make technical decisions |

**Intentional overlaps:**
- §12 (AI Strategy) appears in all 3 — AI boundaries are relevant to product, security, and architecture agents
- §10 (Data Principles) appears in security (partial: compliance subsection only) and architecture (full)
- §15 (Technical Non-Goals) appears in security and architecture — both need to know what's off-limits
- §16 (Change Policy) appears in security and architecture — stability rules affect both domains

## Section Quality Assessment (Critical)

This command will be used across many different products. Some sections may be underdeveloped, placeholder, or missing entirely. Before including a section in an output file, assess it:

**Include the section if ALL of these are true:**
1. The section exists in the source document (heading is present)
2. The section has substantive content (not just the heading, not just "TBD", "TODO", or a single generic sentence)
3. The section contains at least one concrete, product-specific statement

**Skip the section if ANY of these are true:**
- Section heading exists but body is empty or only whitespace
- Content is entirely placeholder text (e.g., "To be determined", "[Fill in later]", only generic template text)
- Section heading doesn't exist in the document at all

**When a section is skipped:**
- Omit it from the output file entirely (don't include an empty heading)
- Record it in the completion report with reason: `skipped: empty | placeholder | missing`

**If ALL sections for an output file are skipped:**
- Do NOT create that output file
- Report: "Skipped `<filename>` — no usable sections found"

## Output File Format

Each generated file follows this structure:

```
<!-- Auto-generated from: .ops/product-vision-strategy.md -->
<!-- Sections: §X, §Y, §Z (list only included sections) -->
<!-- Skipped: §A (empty), §B (placeholder) (list any skipped sections, or "none") -->
<!-- Regenerate: /vision:distill -->

[Section content copied verbatim from source — preserve all markdown formatting, horizontal rules between sections, emphasis, lists, code blocks. Do not reformat, summarize, or edit.]
```

## Behavior

- **Idempotent**: Safe to rerun. Overwrites existing split files without confirmation.
- **Non-destructive**: NEVER modifies the canonical `.ops/product-vision-strategy.md`.
- **Verbatim extraction**: Copy section content exactly. No summarizing, rewording, or reformatting.

## Completion Report

After writing files, output a summary:

```
## Vision Distill Complete

| File | Status | Sections Included | Sections Skipped |
|------|--------|-------------------|------------------|
| quick-product-vision-strategy.md | ✓ created | §1, §2, §3, §5, §7, §12 | §4 (placeholder), §6 (empty) |
| security-compliance-baseline.md | ✓ created | §10, §11, §12, §16 | §15 (missing) |
| tech-architecture-baseline.md | ✓ created | §8, §9, §10, §12, §13, §14, §16 | §15 (missing) |

**Sections with issues** (flesh these out in the canonical doc and rerun `/vision:distill`):
- §4 Value Proposition: placeholder content only
- §6 Success Metrics: empty
- §15 Technical Non-Goals: not found in source

All 16 sections accounted for: ✓
```

The report table adapts to actual results — the example above shows what it looks like when some sections are skipped.

## Command Conventions

Follow the patterns in `db:plan.md` and `interface-design:extract.md`:
- YAML frontmatter with `name` and `description`
- Clear step-by-step process
- Error handling for missing prerequisites
- Output verification

## Quality Scores
- **Clarity**: 78%
- **Efficiency**: 72%
- **Structure**: 65%
- **Completeness**: 60%
- **Actionability**: 70%
- **Specificity**: 82%
- **Overall**: 71% (borderline → comprehensive depth applied)

## Original Prompt
```
create a /vision:distill command that will take product-vision-strategy.md file and and break it down into smaller, AI efficient files. My proposal (but feel free to analyze and let me decide if you want to change something): quick-product-vision-strategy.md: §1, §2, §3, §4, §5, §6, §7, §12; security-compliance-baseline.md: §10, §11, §12, §15, §16; tech-architecture-baseline.md: §8, §9, §10, §12, §13, §14, §15, §16. These files needs to live inside .ops/ (high level) and will be consumed by agents during SDD. It's important that this command scans the original file and judge if a section can be used or not for the file generation every. Why? this command will be used to create many different products, sometimes there will be more clarity around a section than others.
```

## Alternative Approaches

**1. Section-Number Agnostic (Heading-Based Matching)**
Instead of hardcoding §1-§16, match sections by heading text (e.g., "Vision", "Security & Compliance Posture"). More resilient if section numbering changes across products.
*Trade-off:* More flexible but harder to validate completeness ("all 16 sections accounted for").

**2. Config-Driven Mapping**
Store the section-to-file mapping in a `.ops/vision-distill-config.yaml` so users can customize which sections go into which files per project.
*Trade-off:* Maximum flexibility but adds complexity. Probably overkill until you actually need different mappings.

**3. Single Summary File + Full Splits**
Instead of 3 domain files, generate one `quick-vision-summary.md` (condensed to ~50 lines) plus the 3 domain files. The summary would be what CLAUDE.md references for token-constrained contexts.
*Trade-off:* Extra file, but gives agents a "just the headlines" option for ultra-light reads.

## Validation Checklist

Before considering the command done, verify:
- [ ] Command file exists at `.claude/commands/vision/distill.md` with valid frontmatter
- [ ] Running `/vision:distill` against the sample doc produces 3 files under `.ops/`
- [ ] Each output file has the traceability header with correct section list
- [ ] Content is verbatim from source (diff shows no rewording)
- [ ] Skipping logic works: manually empty a section in a test copy and verify it's omitted
- [ ] Completion report shows all 16 sections accounted for
- [ ] Canonical source is untouched after run
- [ ] Rerunning produces identical output (idempotency)
- [ ] Product command's Next Steps section mentions `/vision:distill`

## Edge Cases

- **Source doc uses different section numbering** — What if a product's vision doc has 12 sections instead of 16? The command should match by heading text as fallback, not just `## N.`
- **Section exists but is very short** (1 line) — Qualifies as "substantive" if it's a concrete statement, not a placeholder
- **Multiple `## 10.` headings** — Shouldn't happen, but if it does, take the first one
- **Source doc has extra sections** (§17+) — Report them as "unaccounted" in the completion report, don't silently drop them
