---
id: comp-20260205-150000-r4m9
depthUsed: comprehensive
timestamp: 2026-02-05T15:00:00Z
executed: false
originalPrompt: "based on CLAUDE.md and AGENT.md analyze /claude/commands/orchestrate.md so they are consistent. This file is the command to orchestrate agents. So it needs to follow SDD definitions. Do not make things up."
---

# Improved Prompt

# Update orchestrate.md for SDD Consistency

## Objective
Update `claude/commands/orchestrate.md` to be consistent with the current CLAUDE.md and AGENTS.md definitions. Fix all inconsistencies — do not fabricate new rules.

## Authoritative Sources (in order)
1. AGENTS.md — agent roster, DAG, SDD artifact flow, prerequisite rules
2. CLAUDE.md — project rules, file format references
3. orchestrate.md — the file being corrected

When orchestrate.md conflicts with AGENTS.md or CLAUDE.md, the latter wins.

## Inconsistencies to Fix

### Fix 1: Add Architect to Tier Execution
The architect agent is missing from the tier execution order.
Per AGENTS.md DAG Tier 2: `spec-writer → architect → project-task-planner`

**Current (wrong):**
- Tier 2: spec-writer
- Tier 3: project-task-planner

**Correct:**
- Tier 2 (if needed): spec-writer → architect → project-task-planner
  (sequential within tier: specs first, then system-design, then tasks)

### Fix 2: Align Tier Numbering with AGENTS.md DAG
orchestrate.md has 7 tiers. AGENTS.md DAG has 6.
Align to the 6-tier DAG from AGENTS.md:

```
Tier 1: workflow-orchestrator, context-manager
Tier 2: spec-writer → architect → project-task-planner
Tier 3: ui-designer, security-engineer, compliance-engineer
Tier 4: frontend-designer, database-administrator
Tier 5: fullstack-developer, test-automator
Tier 6: qa, debugger, code-reviewer, security-auditor, compliance-auditor
```

### Fix 3: Add All 3 Prerequisite Rules to Pre-Flight
The pre-flight section only checks system-design after specs.
Per AGENTS.md, there are 3 prerequisite rules:

| Artifact | Prerequisite | On Violation |
|---|---|---|
| specs.md | prd.md must exist | STOP — create prd.md first |
| system-design.yaml | specs.md must exist | STOP — run spec-writer first |
| tasks.yaml | specs.md AND system-design.yaml must exist | STOP — run architect first |

### Fix 4: Fix spec-change-requests Extension
**Current:** `spec-change-requests.md`
**Correct:** `spec-change-requests.yaml` (per AGENTS.md folder structure)

### Fix 5: Fix system-design.yaml Path
Line 24 references `.ops/build/v{x}/system-design.yaml` (version-scoped).
**Correct:** `.ops/build/system-design.yaml` (version-independent, per AGENTS.md)

### Fix 6: Add Knowledge Synthesizer to Execution
Currently only mentioned in a trailing note. Per AGENTS.md, knowledge-synthesizer is in the orchestration category. Add it to Tier 1 or as a post-tier hook when deviations are detected.

## Constraints
- Only modify `claude/commands/orchestrate.md`
- Do NOT touch CLAUDE.md or AGENTS.md
- Do NOT fabricate new agent roles or workflow steps
- All changes must be traceable to existing AGENTS.md/CLAUDE.md definitions
- Preserve the existing structure of orchestrate.md (pre-flight, input, execution steps, rules)
- Keep the file concise — this is a skill (loaded on-demand)

## Process
1. Read current CLAUDE.md (for reference)
2. Read current AGENTS.md (for reference)
3. Read current orchestrate.md
4. Apply all 6 fixes
5. Merge the "Build-level flow addition" appendix into the pre-flight section to avoid redundancy
6. Read back orchestrate.md to verify consistency

## Quality Criteria
- Tier execution order matches AGENTS.md DAG exactly
- Architect appears in tier execution between spec-writer and project-task-planner
- All 3 prerequisite rules present in pre-flight
- Zero references to `spec-change-requests.md` (should be .yaml)
- system-design.yaml path is `.ops/build/system-design.yaml` everywhere
- Knowledge synthesizer has a defined execution point
- No fabricated rules — every change traceable to AGENTS.md or CLAUDE.md
- "Build-level flow addition" appendix merged (no dangling section at end)

## Quality Scores
- **Clarity**: 92%
- **Efficiency**: 88%
- **Structure**: 95%
- **Completeness**: 92%
- **Actionability**: 93%
- **Specificity**: 90%
- **Overall**: 92% (excellent)

## Original Prompt
```
based on CLAUDE.md and AGENT.md analyze /claude/commands/orchestrate.md so they are consistent. This file is the command to orchestrate agents. So it needs to follow SDD definitions. Do not make things up.
```

## Validation Checklist
- [ ] Tier execution order matches AGENTS.md 6-tier DAG
- [ ] Architect in Tier 2 between spec-writer and project-task-planner
- [ ] All 3 prerequisite rules in pre-flight section
- [ ] `spec-change-requests.yaml` (not .md) everywhere
- [ ] `system-design.yaml` path is `.ops/build/system-design.yaml` (no `v{x}`)
- [ ] Knowledge synthesizer has defined execution point
- [ ] "Build-level flow addition" appendix merged into pre-flight
- [ ] No fabricated content — all changes from AGENTS.md/CLAUDE.md

## Edge Cases
- The "Build-level flow addition" at the end of orchestrate.md (lines 102-106) partially duplicates the pre-flight section — merge into pre-flight to avoid redundancy
- orchestrate.md uses `$ARGUMENTS` which is correct for a Claude Code skill — preserve this
- The keyword trigger table for auto-detecting agents is orchestrate-specific (not in AGENTS.md) — preserve as-is since it's implementation detail for the orchestrator
